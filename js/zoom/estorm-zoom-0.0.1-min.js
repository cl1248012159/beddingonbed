/*! Estorm.Cn 0.0.1 2014-07-22 */
!function(a){"use strict";a.fn.estormZoom=function(b){var c={loading:{img:"images/loading.gif",bgcolor:"#ffffff"},zoom:{borderColor:"#888888",borderWidth:5,scale:.4,opacity:.4}},d=a.extend(!0,{},c,b||{}),e=this,f={init:function(b){var c=b,e=c.find(".estorm-zoom-gallery li.item"),g=c.data("config"),h=c.find(".estorm-zoom-gallery ul"),i=e.eq(0).outerWidth(),j=e.length,k=g.colsnumber;h.data("old",0),c.find(".estorm-zoom-gallery").append(f.btn()),e.on("click","a",function(){var b=a(this).parent(),d=e.index(b),g=a(this).attr("href"),l=a(this).find("img").attr("title"),m=a(this).data("middle")?a(this).data("middle"):a(this).find("img").attr("src"),n=a(this).closest(".estorm-zoom-gallery").siblings("div.estorm-zoom-stage");f.slider(d,h,j,k,i),f.showArrow(c,d,j),b.addClass("current").siblings("li.item").removeClass("current");var o=function(){n.find("img").data("bigurl",g).attr("title",l),n.find("div.estorm-zoom-drag").css("background-image","url("+m+")")};return f.loadMiddleimage(n,m,o),!1});var l=h.parent().find("a.arrow-prev"),m=h.parent().find("a.arrow-next");l.on("click",function(){var a=h.data("old");return a-1>=0&&e.eq(a-1).find("a").trigger("click"),f.showArrow(c,a-1,j),!1}),m.on("click",function(){var a=h.data("old");return j-1>=a+1&&e.eq(a+1).find("a").trigger("click"),f.showArrow(c,a+1,j),!1}),e.eq(0).find("a").trigger("click");var n=c.find("div.estorm-zoom-stage"),o=n.find("img"),p=f.magnifier(o.width()*d.zoom.scale,o.height()*d.zoom.scale,o.attr("src"));n.append(p),n.on("mouseover",function(){f.showDrag(a(this),g),a("body").on("mousemove",{me:a(this)},f.moveEvent)}).on("mouseleave",function(){f.hideDrag(a(this)),a("body").off("mousemove")})},moveEvent:function(b){var c=b.data.me,e=a(document).scrollLeft(),f=a(document).scrollTop(),g=[b.clientX+e,b.clientY+f],h=c.find("div.estorm-zoom-drag"),i=c.find(".estorm-zoom-outline"),j=c.offset(),k=h.width(),l=h.height(),m=[j.left+k/2-d.zoom.borderWidth,j.left+c.width()-k/2-d.zoom.borderWidth,j.top+l/2-d.zoom.borderWidth,j.top+c.height()-l/2-d.zoom.borderWidth],n=0,o=0;n=g[0]<m[0]?0:g[0]>m[1]?m[1]-m[0]:g[0]-m[0],o=g[1]<m[2]?0:g[1]>m[3]?m[3]-m[2]:g[1]-m[2],h.css({left:n-d.zoom.borderWidth,top:o-d.zoom.borderWidth,"background-position":"-"+n+"px -"+o+"px"});var p=Number(i.data("scale")),q=n*p,r=o*p;i.css({"background-position":"-"+q+"px -"+r+"px"})},loadBigimage:function(b,c,e){var f=new Image;f.src=c,f.complete||f.width?e&&a.isFunction(e)&&e(f):(b.css({background:"url("+d.loading.img+") no-repeat center center "+d.loading.bgcolor}),a(f).load(function(){b.css("background","url("+c+") no-repeat 0 0 "+d.loading.bgcolor),e&&a.isFunction(e)&&e(f)}))},loadMiddleimage:function(b,c,e){var f=new Image;if(f.src=c,f.complete||f.width)b.find("img").attr("src",c),e&&a.isFunction(e)&&e(f);else{var g=b.css("background");b.css({background:"url("+d.loading.img+") no-repeat center center "+d.loading.bgcolor}),b.find("img").hide(),a(f).load(function(){b.css({background:g}),b.find("img").attr("src",c).show(),e&&a.isFunction(e)&&e(f)})}},showDrag:function(a,b){if(a.find("img").stop(!0,!0).animate({opacity:d.zoom.opacity},600),a.find("div.estorm-zoom-drag").fadeIn(200),!a.find(".estorm-zoom-outline")[0]){var c=f.outline(0,0,0,0,b.zindex,a.find("img").data("bigurl"));a.append(c)}var e=a.find(".estorm-zoom-outline"),g=function(b){var c=a.find("div.estorm-zoom-drag").width(),d=a.find("div.estorm-zoom-drag").height(),f=c*b.width/a.width(),g=d*b.height/a.height(),h=b.width/a.width();e.css({width:f,height:g,left:a.width()+20,top:0,background:"url("+b.src+") no-repeat 0 0"}).show().data("scale",h)};f.loadBigimage(e,a.find("img").data("bigurl"),g)},hideDrag:function(a){a.find("img").stop(!0,!0).animate({opacity:1},200),a.find("div.estorm-zoom-drag").fadeOut(200);var b=a.find(".estorm-zoom-outline");b.hide()},showArrow:function(a,b,c){var d=a,e=d.find("a.arrow-prev"),f=d.find("a.arrow-next");0>=b?e.hide():e.show(),b>=c-1?f.hide():f.show()},slider:function(a,b,c,d,e){if(c>d){var f=0,g=b.data("old");if(a>g)f=a>c-d?c-d:a;else if(g>a)f=d>a?0:a-(d-1);else{var h=-Number(b.css("left").replace("px",""));f=d-1>a?0:a>c-d?c-d:h==a*e?a-(d-1):a}b.animate({left:-f*e},100),b.data("old",a)}},btn:function(){var a='<a href="javascript:;" class="arrow arrow-prev">上一张</a><a href="javascript:;" class="arrow arrow-next">下一张</a>';return a},magnifier:function(a,b,c){var e='<div class="estorm-zoom-drag" style="width:'+a+"px; height:"+b+"px; position:absolute; border:"+d.zoom.borderWidth+"px "+d.zoom.borderColor+" solid; box-shadow:0 0 10px rgba(0,0,0,0.3); background:url("+c+') no-repeat 0 0; display:none;"><div>';return e},outline:function(a,b,c,e,f,g){var h='<div class="estorm-zoom-outline" style="width:'+a+"px; height:"+b+"px; position:absolute; overflow:hidden; z-index:"+f+"; left:"+c+"px; top:"+e+"px; background:url("+g+") no-repeat 0 0; box-shadow:0 0 15px rgba(0,0,0,0.3); border:1px "+d.zoom.borderColor+' solid; display:none;"></div>';return h}};a.each(e,function(){var b=a(this);f.init(b)})}}(jQuery);